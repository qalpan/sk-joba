<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SK-Joba | Full System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <style>
        body { font-family: sans-serif; margin: 0; background: #f0f2f5; }
        .search-box { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 85%; max-width: 400px; }
        .search-box input { width: 100%; padding: 12px; border-radius: 25px; border: 2px solid #007bff; box-shadow: 0 4px 10px rgba(0,0,0,0.2); outline: none; }
        #map { height: 50vh; width: 100%; }
        .container { padding: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input, select, textarea, button { width: 100%; margin: 5px 0; padding: 10px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; font-weight: bold; cursor: pointer; }
        .leaflet-tooltip { background: white !important; border: 2px solid #007bff !important; font-weight: bold !important; padding: 2px 4px !important; font-size: 11px !important; }
        #admin-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; padding:20px; overflow-y:auto; }
    </style>
</head>
<body>

<div class="search-box">
    <input type="text" id="searchInput" placeholder="–Ü–∑–¥–µ—É: “õ—ã–∑–º–µ—Ç, —Ç–∞—É–∞—Ä..." oninput="filterMarkers()">
</div>

<div id="map"></div>

<div id="admin-modal">
    <button onclick="window.location.hash=''" style="background:red; width:100px;">‚ùå –ñ–∞–±—É</button>
    <h2>–ê–¥–º–∏–Ω: –¢”©–ª–µ–º–¥–µ—Ä–¥—ñ —Ä–∞—Å—Ç–∞—É</h2>
    <div id="admin-list"></div>
</div>

<div class="container">
    <div class="card">
        <h4>üë∑ “ö—ã–∑–º–µ—Ç</h4>
        <input id="w_name" placeholder="–ê—Ç—ã“£—ã–∑">
        <input id="w_job" placeholder="–ú–∞–º–∞–Ω–¥—ã“õ">
        <input id="w_phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
        <select id="w_dur"><option value="1">1 —Å–∞“ì–∞—Ç (49‚Ç∏)</option><option value="24">1 —Ç”ô—É–ª—ñ–∫ (490‚Ç∏)</option></select>
        <button onclick="saveItem('worker')">–¢—ñ—Ä–∫–µ–ª—É</button>
    </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<script>
    const API = "https://sk-joba.onrender.com";
    const myToken = localStorage.getItem('token') || Math.random().toString(36).substr(2);
    localStorage.setItem('token', myToken);

    const map = L.map('map').setView([43.2389, 76.8897], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    const markersGroup = L.markerClusterGroup();
    map.addLayer(markersGroup);

    let allData = { workers: [], goods: [], orders: [] };

    // –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ –ê–®–£
    window.onhashchange = () => {
        if(location.hash === "#admin777") {
            const p = prompt("Password:");
            if(p === "admin777") { 
                document.getElementById('admin-modal').style.display='block'; 
                loadAdmin(); 
            }
        } else { 
            document.getElementById('admin-modal').style.display='none'; 
        }
    };

    function loadAdmin() {
        fetch(API+'/admin/pending').then(r => r.json()).then(list => {
            let h = `<table border="1" style="width:100%; border-collapse:collapse;"><tr><th>–ê“õ–ø–∞—Ä–∞—Ç</th><th>–ë–∞“ì–∞</th><th>”ò—Ä–µ–∫–µ—Ç</th></tr>`;
            list.forEach(i => {
                h += `<tr><td>${i.info}<br>${i.phone}</td><td style="color:red; font-weight:bold">${i.price}</td>
                <td><button onclick="activate(${i.id},'${i.type}')">‚úÖ “ö–æ—Å</button>
                <button onclick="delItem(${i.id},'${i.type}',true)" style="background:red">‚ùå</button></td></tr>`;
            });
            document.getElementById('admin-list').innerHTML = list.length ? h + "</table>" : "–¢”©–ª–µ–º –∫“Ø—Ç—ñ–ª—É–¥–µ–≥—ñ ”©—Ç—ñ–Ω—ñ–º–¥–µ—Ä –∂–æ“õ.";
        });
    }

    function activate(id, type) {
        fetch(API+'/admin/activate', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id, type})})
        .then(() => loadAdmin());
    }

    // –ë“±—Ä—ã–Ω“ì—ã saveItem, loadMarkers –∂”ô–Ω–µ filterMarkers —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä—ã–Ω –æ—Å—ã –∂–µ—Ä–≥–µ —Ç–æ–ª—ã“õ “õ–æ—Å—ã“£—ã–∑ (–∞–ª–¥—ã“£“ì—ã –∫–æ–¥—Ç–∞“ì—ã–¥–∞–π)
    // –¢–µ–∫ saveItem —ñ—à—ñ–Ω–¥–µ–≥—ñ alert-—Ç—ñ “±–º—ã—Ç–ø–∞“£—ã–∑.
    
    function saveItem(type) {
        // ... (–±“±—Ä—ã–Ω“ì—ã –≤–∞–ª–∏–¥–∞—Ü–∏—è–ª–∞—Ä)
        fetch(API+path, {method:'POST', ...})
        .then(() => {
            alert("–ê“õ–ø–∞—Ä–∞—Ç —Ç—ñ—Ä–∫–µ–ª—É–≥–µ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ. –¢”©–ª–µ–º–Ω–µ–Ω –∫–µ–π—ñ–Ω –∞–¥–º–∏–Ω –∫–∞—Ä—Ç–∞“ì–∞ —à—ã“ì–∞—Ä–∞–¥—ã!");
            loadMarkers();
        });
    }
    
    loadMarkers();
    setInterval(loadMarkers, 30000);
</script>
</body>
</html>
