<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Service Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        /* –¢”©–º–µ–Ω–≥—ñ –º”ô–∑—ñ—Ä –¥–∏–∑–∞–π–Ω—ã */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; display: flex; gap: 10px; background: rgba(255, 255, 255, 0.9);
            padding: 15px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px); width: 90%; max-width: 400px; justify-content: center;
        }
        
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            cursor: pointer; transition: 0.3s; padding: 5px;
        }
        .nav-item:hover { transform: translateY(-5); color: #3498db; }
        .nav-item span { font-size: 20px; }
        .nav-item label { font-size: 10px; font-weight: bold; margin-top: 5px; }

        /* "–ñ“±–º—ã—Å“õ–∞ —à—ã“ì—É" –±–∞—Ç—ã—Ä–º–∞—Å—ã */
        .work-btn {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            background: #27ae60; color: white; border: none; padding: 12px 20px;
            border-radius: 50px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
        }
    </style>
</head>
<body>

    <button class="work-btn" onclick="startTracking()">üü¢ –ñ“±–º—ã—Å“õ–∞ —à—ã“ì—É</button>

    <div id="map"></div>

    <div class="bottom-nav">
        <div class="nav-item" onclick="filterMarkers('all')"><span>üåç</span><label>–ë–∞—Ä–ª—ã“ì—ã</label></div>
        <div class="nav-item" onclick="filterMarkers('üõ†')"><span>üõ†</span><label>–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫</label></div>
        <div class="nav-item" onclick="filterMarkers('‚ö°')"><span>‚ö°</span><label>–≠–ª–µ–∫—Ç—Ä–∏–∫</label></div>
        <div class="nav-item" onclick="filterMarkers('üõí')"><span>üõí</span><label>–î“Ø–∫–µ–Ω</label></div>
        <div class="nav-item" onclick="filterMarkers('üì¶')"><span>üì¶</span><label>–ö—É—Ä—å–µ—Ä</label></div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    const socket = io("https://sk-joba.onrender.com");
    let myName = "";

    function startTracking() {
        myName = prompt("–ê—Ç—ã“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑:");
        const role = prompt("–†”©–ª—ñ“£—ñ–∑–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑ (üõ†, ‚ö°, üõí, üì¶):", "üõ†");
        
        // –°–µ—Ä–≤–µ—Ä–≥–µ ”©–∑—ñ–º—ñ–∑–¥—ñ —Ç—ñ—Ä–∫–µ–π–º—ñ–∑
        socket.emit('register', myName);

        if (navigator.geolocation) {
            navigator.geolocation.watchPosition((position) => {
                const { latitude, longitude } = position.coords;
                socket.emit('send_location', { id: myName, role: role, lat: latitude, lng: longitude });
                // ”®–∑ –º–∞—Ä–∫–µ—Ä—ñ–º—ñ–∑–¥—ñ –∫”©—Ä—Å–µ—Ç—É...
            });
        }
    }

    // 1. –ö–õ–ò–ï–ù–¢: –¢–∞–ø—Å—ã—Ä—ã—Å –∂—ñ–±–µ—Ä—É
    function orderService(providerId) {
        if (!myName) myName = "“ö–æ–Ω–∞“õ_" + Math.floor(Math.random() * 1000);
        socket.emit('order_request', { to: providerId, from: myName });
        alert(providerId + " –º–∞–º–∞–Ω“ì–∞ —Å“±—Ä–∞–Ω—ã—Å –∫–µ—Ç—Ç—ñ. –ñ–∞—É–∞–ø –∫“Ø—Ç—ñ“£—ñ–∑...");
    }

    // 2. –ú–ê–ú–ê–ù: –¢–∞–ø—Å—ã—Ä—ã—Å—Ç—ã “õ–∞–±—ã–ª–¥–∞—É
    socket.on('order_received', (data) => {
        const audio = new Audio('https://www.soundjay.com/buttons/beep-01a.mp3');
        audio.play(); // –¢–∞–ø—Å—ã—Ä—ã—Å –∫–µ–ª–≥–µ–Ω–¥–µ –¥—ã–±—ã—Å —à—ã“ì–∞—Ä—É
        
        if (confirm(`–ñ–ê“¢–ê –¢–ê–ü–°–´–†–´–°!\n–¢–∞–ø—Å—ã—Ä—ã—Å –±–µ—Ä—É—à—ñ: ${data.from}\n“ö–∞–±—ã–ª–¥–∞–π—Å—ã–∑ –±–∞?`)) {
            socket.emit('order_response', { toClient: data.from, from: myName, status: 'accepted' });
        } else {
            socket.emit('order_response', { toClient: data.from, from: myName, status: 'rejected' });
        }
    });

    // 3. –ö–õ–ò–ï–ù–¢: –ú–∞–º–∞–Ω–Ω—ã“£ –∂–∞—É–∞–±—ã–Ω –∞–ª—É
    socket.on('order_final_status', (data) => {
        if (data.status === 'accepted') {
            alert(`‚úÖ ${data.providerName} —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç—ã “õ–∞–±—ã–ª–¥–∞–¥—ã! –û–ª —Å—ñ–∑–≥–µ “õ–∞—Ä–∞–π –∂–æ–ª“ì–∞ —à—ã“õ—Ç—ã.`);
        } else {
            alert(`‚ùå –ö–µ—à—ñ—Ä—ñ“£—ñ–∑, ${data.providerName} “õ–∞–∑—ñ—Ä –±–æ—Å –µ–º–µ—Å.`);
        }
    });
    
    // –ö–∞—Ä—Ç–∞–¥–∞“ì—ã –º–∞—Ä–∫–µ—Ä–ª–µ—Ä–¥—ñ —Å—É—Ä–µ—Ç—Ç–µ—É –∫–æ–¥—ã (–∞–ª–¥—ã“£“ì—ã –∫–æ–¥–ø–µ–Ω –±—ñ—Ä–¥–µ–π)...
</script>
</body>
</html>
