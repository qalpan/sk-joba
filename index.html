<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Service Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        /* –¢”©–º–µ–Ω–≥—ñ –º”ô–∑—ñ—Ä –¥–∏–∑–∞–π–Ω—ã */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; display: flex; gap: 10px; background: rgba(255, 255, 255, 0.9);
            padding: 15px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px); width: 90%; max-width: 400px; justify-content: center;
        }
        
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            cursor: pointer; transition: 0.3s; padding: 5px;
        }
        .nav-item:hover { transform: translateY(-5); color: #3498db; }
        .nav-item span { font-size: 20px; }
        .nav-item label { font-size: 10px; font-weight: bold; margin-top: 5px; }

        /* "–ñ“±–º—ã—Å“õ–∞ —à—ã“ì—É" –±–∞—Ç—ã—Ä–º–∞—Å—ã */
        .work-btn {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            background: #27ae60; color: white; border: none; padding: 12px 20px;
            border-radius: 50px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
        }
    </style>
</head>
<body>

    <button class="work-btn" onclick="startTracking()">üü¢ –ñ“±–º—ã—Å“õ–∞ —à—ã“ì—É</button>

    <div id="map"></div>

    <div class="bottom-nav">
        <div class="nav-item" onclick="filterMarkers('all')"><span>üåç</span><label>–ë–∞—Ä–ª—ã“ì—ã</label></div>
        <div class="nav-item" onclick="filterMarkers('üõ†')"><span>üõ†</span><label>–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫</label></div>
        <div class="nav-item" onclick="filterMarkers('‚ö°')"><span>‚ö°</span><label>–≠–ª–µ–∫—Ç—Ä–∏–∫</label></div>
        <div class="nav-item" onclick="filterMarkers('üõí')"><span>üõí</span><label>–î“Ø–∫–µ–Ω</label></div>
        <div class="nav-item" onclick="filterMarkers('üì¶')"><span>üì¶</span><label>–ö—É—Ä—å–µ—Ä</label></div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        const socket = io("https://sk-joba.onrender.com"); // Render —Å—ñ–ª—Ç–µ–º–µ—Å—ñ–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑
        const map = L.map('map', { zoomControl: false }).setView([43.238, 76.889], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        let myMarker;
        const markers = {}; 
        let currentRole = "üõí"; // ”ò–¥–µ–ø–∫—ñ —Ä”©–ª

        // –¢“Ø—Ä—ñ–Ω–µ “õ–∞—Ä–∞–π –º–∞–º–∞–Ω–¥—ã —Ç–∞“£–¥–∞—É
        function filterMarkers(role) {
            currentRole = role;
            alert("–°—ñ–∑ —Ç–∞“£–¥–∞“ì–∞–Ω —Å–∞–Ω–∞—Ç: " + (role === 'all' ? '–ë–∞—Ä–ª—ã“ì—ã' : role));
            // –ë“±–ª –∂–µ—Ä–¥–µ –∫–∞—Ä—Ç–∞–¥–∞“ì—ã –º–∞—Ä–∫–µ—Ä–ª–µ—Ä–¥—ñ –∂–∞—Å—ã—Ä—É –ª–æ–≥–∏–∫–∞—Å—ã–Ω “õ–æ—Å—É“ì–∞ –±–æ–ª–∞–¥—ã
        }

        function startTracking() {
            const name = prompt("–ê—Ç—ã“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑:");
            const role = prompt("–†”©–ª—ñ“£—ñ–∑–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑ (üõ†, ‚ö°, üõí, üì¶):", "üõ†");
            
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition((position) => {
                    const { latitude, longitude } = position.coords;
                    
                    if (!myMarker) {
                        myMarker = L.marker([latitude, longitude]).addTo(map).bindPopup("–ú–µ–Ω: " + name).openPopup();
                    } else {
                        myMarker.setLatLng([latitude, longitude]);
                    }
                    map.setView([latitude, longitude], 15);

                    socket.emit('send_location', { id: name, role: role, lat: latitude, lng: longitude });
                });
            }
        }

        socket.on('receive_location', (data) => {
            if (markers[data.id]) {
                markers[data.id].setLatLng([data.lat, data.lng]);
            } else {
                const icon = L.divIcon({
                    html: `<div style="font-size: 24px;">${data.role}</div>`,
                    className: 'custom-div-icon'
                });
                markers[data.id] = L.marker([data.lat, data.lng], { icon: icon }).addTo(map)
                    .bindPopup(`<b>${data.role} ${data.id}</b><br><button onclick="orderService('${data.id}')">–¢–∞–ø—Å—ã—Ä—ã—Å –±–µ—Ä—É</button>`);
            }
        });

        function orderService(id) {
            alert(id + " –º–∞–º–∞–Ω“ì–∞ —Ç–∞–ø—Å—ã—Ä—ã—Å –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ! –ñ–∞—É–∞–ø –∫“Ø—Ç—ñ“£—ñ–∑.");
        }
    </script>
</body>
</html>
