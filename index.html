<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SK-Joba Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <style>
        :root { --primary: #007bff; --success: #28a745; --warning: #ffc107; }
        body { font-family: sans-serif; margin: 0; background: #f4f7f6; }
        .header-box { position: sticky; top: 0; z-index: 1000; text-align: center; padding: 10px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .search-input { width: 90%; padding: 12px; border-radius: 25px; border: 2px solid var(--primary); outline: none; font-size: 16px; }
        
        .style-switcher { display: flex; justify-content: center; gap: 10px; margin-top: 8px; }
        .style-btn { padding: 6px 14px; border-radius: 15px; border: 1px solid #ddd; background: #eee; cursor: pointer; font-size: 12px; }
        .style-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        #map { height: 45vh; width: 100%; border-bottom: 3px solid var(--primary); }
        
        /* –ú–∞—Ä–∫–µ—Ä –∂–∞–∑—É–ª–∞—Ä—ã–Ω—ã“£ “õ–∞–±–∞—Ç—Ç–∞—Å—É—ã–Ω —Ä–µ—Ç—Ç–µ—É */
.marker-label {
    background: white;
    border: 1px solid #999;
    border-radius: 3px;
    padding: 1px 4px;
    font-size: 10px;
    white-space: nowrap;
    position: relative;
    z-index: 1000; /* –ñ–∞–∑—É –º–∞—Ä–∫–µ—Ä–¥—ñ“£ –∞—Ä—Ç—ã–Ω–¥–∞ “õ–∞–ª–º–∞—É—ã “Ø—à—ñ–Ω */
    pointer-events: none; /* –ñ–∞–∑—É –º–∞—Ä–∫–µ—Ä–¥—ñ –±–∞—Å—É“ì–∞ –∫–µ–¥–µ—Ä–≥—ñ –∂–∞—Å–∞–º–∞—É—ã –∫–µ—Ä–µ–∫ */
}

/* –¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ –º–µ–Ω —Ç–∞“£–±–∞—Å—ã–Ω –±—ñ—Ä –∂–æ–ª“ì–∞ “õ–æ—é */
.contact-line {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px; /* –¢–∞“£–±–∞ –º–µ–Ω –Ω”©–º—ñ—Ä –∞—Ä–∞—Å—ã–Ω–¥–∞“ì—ã “õ–∞—à—ã“õ—Ç—ã“õ */
    background: #f0fdf4; /* –°”ô–ª –∂–∞—Å—ã–ª–¥–∞—É —Ñ–æ–Ω */
    border: 1px solid #bbf7d0;
    border-radius: 6px;
    padding: 6px 12px;
    margin: 8px 0;
    color: #166534;
    font-weight: bold;
    font-size: 14px;
}

        #visible-list-container { background: white; margin: 10px; border-radius: 12px; height: 25vh; overflow-y: auto; }
        .list-item { padding: 12px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start; }
        
        /* –ë–ê–ô–õ–ê–ù–´–° –ë–ï–õ–ì–Ü–õ–ï–†–Ü–ù–Ü“¢ –°–¢–ò–õ–Ü - –ö–û–ú–ü–¨–Æ–¢–ï–† “Æ–®–Ü–ù –´“¢“í–ê–ô–õ–´ */
        .contact-badge {
            display: block; /* ”ò—Ä“õ–∞–π—Å—ã—Å—ã –∂–∞“£–∞ –∂–æ–ª–¥–∞–Ω —à—ã“ì–∞–¥—ã */
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 13px;
            margin-top: 4px;
            color: #212529;
            font-weight: bold;
        }

        .container { padding: 15px; display: grid; gap: 15px; }
        .card { background: white; padding: 15px; border-radius: 10px; border-top: 5px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input, textarea, button, select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ddd; box-sizing: border-box; }
        button { color: white; border: none; font-weight: bold; cursor: pointer; }
        
        .contact-row { display: flex; gap: 5px; margin-top: 5px; }
        .add-contact-btn { background: #6c757d; font-size: 12px; padding: 5px; width: auto; margin-top: 5px; }

        #admin-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; padding:15px; overflow-y:auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 11px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>

<div class="header-box">
    <input type="text" id="searchInput" class="search-input" placeholder="üîç –Ü–∑–¥–µ—É..." oninput="filterMarkers()">
    <div class="style-switcher">
        <button id="btn-color" class="style-btn active" onclick="changeMapStyle('color')">–¢“Ø—Å—Ç—ñ</button>
        <button id="btn-mono" class="style-btn" onclick="changeMapStyle('mono')">–ê“õ-“õ–∞—Ä–∞</button>
    </div>
</div>

<div id="map"></div>

<div id="visible-list-container">
    <div style="padding:10px; font-weight:bold; background:#eee; position: sticky; top:0;">üìç –ñ–∞“õ—ã–Ω –º–∞“£–¥–∞: (<span id="item-count">0</span>)</div>
    <div id="dynamic-list-content"></div>
</div>

<div class="container">
    <div class="card" style="border-color: var(--primary);">
        <h4>üë∑ “ö—ã–∑–º–µ—Ç –∂–∞—Ä–∏—è–ª–∞—É</h4>
        <input id="w_name" placeholder="–ê—Ç—ã“£—ã–∑">
        <input id="w_job" placeholder="–ú–∞–º–∞–Ω–¥—ã“õ">
        <div id="w_contacts_list">
            <div class="contact-row">
                <select style="width:35%" class="c-type"><option>–¢–µ–ª</option><option>Email</option><option>Skype</option><option>WhatsApp</option></select>
                <input style="width:65%" class="c-val" placeholder="–î–µ—Ä–µ–∫ (–º—ã—Å–∞–ª—ã: 8707...)">
            </div>
        </div>
        <button type="button" class="add-contact-btn" onclick="addContactRow('w_contacts_list')">+ –ë–∞–π–ª–∞–Ω—ã—Å “õ–æ—Å—É</button>
        <button onclick="saveItem('worker', false)" style="background:var(--primary); margin-top:15px;">–¢–µ–≥—ñ–Ω –∂–∞—Ä–∏—è–ª–∞—É</button>
        <button onclick="initVIP('worker')" style="background:#0056b3">üíé VIP –∂–∞—Ä–∏—è–ª–∞—É</button>
    </div>

    <div class="card" style="border-color: var(--warning);">
        <h4>üì¶ –¢–∞—É–∞—Ä —Å–∞—Ç—É</h4>
        <input id="g_name" placeholder="–°–∞—Ç—É—à—ã –∞—Ç—ã">
        <input id="g_prod" placeholder="–¢–∞—É–∞—Ä –∞—Ç—ã">
        <input id="g_price" placeholder="–ë–∞“ì–∞—Å—ã">
        <div id="g_contacts_list">
            <div class="contact-row">
                <select style="width:35%" class="c-type"><option>–¢–µ–ª</option><option>Email</option><option>Skype</option><option>WhatsApp</option></select>
                <input style="width:65%" class="c-val" placeholder="–î–µ—Ä–µ–∫">
            </div>
        </div>
        <button type="button" class="add-contact-btn" onclick="addContactRow('g_contacts_list')">+ –ë–∞–π–ª–∞–Ω—ã—Å “õ–æ—Å—É</button>
        <button onclick="saveItem('good', false)" style="background:var(--warning); margin-top:15px;">–¢–µ–≥—ñ–Ω –∂–∞—Ä–∏—è–ª–∞—É</button>
        <button onclick="initVIP('good')" style="background:#d39e00">üíé VIP –∂–∞—Ä–∏—è–ª–∞—É</button>
    </div>

    <div class="card" style="border-color: var(--success);">
        <h4>üìã –¢–∞–ø—Å—ã—Ä—ã—Å –±–µ—Ä—É</h4>
        <input id="c_name" placeholder="–ê—Ç—ã“£—ã–∑">
        <textarea id="c_desc" placeholder="–ù–µ –∫–µ—Ä–µ–∫?"></textarea>
        <div id="o_contacts_list">
            <div class="contact-row">
                <select style="width:35%" class="c-type"><option>–¢–µ–ª</option><option>Email</option><option>Skype</option><option>WhatsApp</option></select>
                <input style="width:65%" class="c-val" placeholder="–î–µ—Ä–µ–∫">
            </div>
        </div>
        <button type="button" class="add-contact-btn" onclick="addContactRow('o_contacts_list')">+ –ë–∞–π–ª–∞–Ω—ã—Å “õ–æ—Å—É</button>
        <button onclick="saveItem('order', false)" style="background:var(--success); margin-top:15px;">–¢–µ–≥—ñ–Ω –∂–∞—Ä–∏—è–ª–∞—É</button>
        <button onclick="initVIP('order')" style="background:#1e7e34">üíé VIP —Ç–∞–ø—Å—ã—Ä—ã—Å</button>
    </div>
</div>

<div id="admin-modal">
    <div style="display:flex; justify-content: space-between; align-items: center;">
        <h3>–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</h3>
        <button onclick="location.hash=''" style="background:red; width: auto; padding: 5px 15px;">–ñ–∞–±—É</button>
    </div>
    <div id="admin-content"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<script>
    const API = "https://sk-joba.onrender.com"; 
    const myToken = localStorage.getItem('token') || Math.random().toString(36).substr(2);
    localStorage.setItem('token', myToken);

    const map = L.map('map').setView([43.2389, 76.8897], 13);
    const baseLayers = {
        color: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
        mono: L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png')
    };
    baseLayers.color.addTo(map);

    function changeMapStyle(s) {
        map.removeLayer(baseLayers.color); map.removeLayer(baseLayers.mono);
        baseLayers[s].addTo(map);
        document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + s).classList.add('active');
    }

    const markersGroup = L.markerClusterGroup({ spiderfyOnMaxZoom: true, maxClusterRadius: 30 });
    map.addLayer(markersGroup);

    let rawData = [];
    let adminDataFull = null;

    function addContactRow(containerId) {
        const div = document.createElement('div');
        div.className = 'contact-row';
        div.innerHTML = `
            <select style="width:35%" class="c-type"><option>–¢–µ–ª</option><option>Email</option><option>Skype</option><option>WhatsApp</option></select>
            <input style="width:60%" class="c-val" placeholder="–î–µ—Ä–µ–∫">
            <button onclick="this.parentElement.remove()" style="width:5%; background:none; color:red; padding:0;">‚úï</button>
        `;
        document.getElementById(containerId).appendChild(div);
    }

    function collectContacts(containerId) {
        let contacts = [];
        const rows = document.getElementById(containerId).querySelectorAll('.contact-row');
        rows.forEach(r => {
            const type = r.querySelector('.c-type').value;
            const val = r.querySelector('.c-val').value;
            if(val) contacts.push({type, val});
        });
        return JSON.stringify(contacts);
    }

    // –ë“∞–õ –§–£–ù–ö–¶–ò–Ø –ñ”®–ù–î–ï–õ–î–Ü: –ù”©–º—ñ—Ä–ª–µ—Ä–¥—ñ –º”ô—Ç—ñ–Ω —Ä–µ—Ç—ñ–Ω–¥–µ –∞–Ω—ã“õ —à—ã“ì–∞—Ä–∞–¥—ã
    function formatContacts(json) {
        try {
            const arr = JSON.parse(json || '[]');
            if(arr.length === 0) return '';
            // ”ò—Ä –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã –∂–∞“£–∞ –∂–æ–ª–¥–∞–Ω –∂”ô–Ω–µ –±–µ–ª–≥—ñ—Å—ñ–º–µ–Ω –∫”©—Ä—Å–µ—Ç–µ–º—ñ–∑
            return arr.map(c => `<div class="contact-badge"><span>${c.type}:</span> ${c.val}</div>`).join('');
        } catch(e) { 
            return `<div class="contact-badge">${json}</div>`; 
        }
    }

    function loadMarkers() {
        fetch(API + '/get-all').then(r => r.json()).then(data => {
            adminDataFull = data.admin_all;
            const newData = [];
            if(data.workers) data.workers.forEach(x => newData.push({...x, type:'worker', info: x.job, title: x.name}));
            if(data.goods) data.goods.forEach(x => newData.push({...x, type:'good', info: x.product_name, title: x.seller_name}));
            if(data.orders) data.orders.forEach(x => newData.push({...x, type:'order', info: x.description, title: x.client_name}));
            
            rawData = newData;
            filterMarkers();
            if(location.hash === '#admin777') renderAdmin();
        });
    }

// 1. –ë–∞–π–ª–∞–Ω—ã—Å –∞“õ–ø–∞—Ä–∞—Ç—ã–Ω –º”ô—Ç—ñ–Ω —Ç“Ø—Ä—ñ–Ω–¥–µ –¥–∞–π—ã–Ω–¥–∞—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
function formatContacts(item) {
    let html = '';
    
    // –ï–≥–µ—Ä –±–∞—Å—Ç—ã —Ç–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ –±–æ–ª—Å–∞, –æ–Ω—ã –±—ñ—Ä–¥–µ–Ω —à—ã“ì–∞—Ä—É
    if (item.phone) {
        html += `<div class="contact-badge" style="font-size:14px; color:#d63384;">${item.phone}</div>`;
    }

    // –ï–≥–µ—Ä “õ–æ—Å—ã–º—à–∞ contacts (Email, Skype —Ç.–±.) –±–æ–ª—Å–∞, –æ–ª–∞—Ä–¥—ã –¥–∞ –º”ô—Ç—ñ–Ω–º–µ–Ω —à—ã“ì–∞—Ä—É
    try {
        const arr = typeof item.contacts === 'string' ? JSON.parse(item.contacts || '[]') : (item.contacts || []);
        arr.forEach(c => {
            // "–¢–µ–ª" –¥–µ–≥–µ–Ω –∂–∞–∑—É–¥—ã “õ–∞–π—Ç–∞–ª–∞–º–∞—É “Ø—à—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É
            if (c.val && c.val !== item.phone) {
                html += `<div class="contact-badge" style="font-size:13px; border-color:#007bff;">${c.type}: ${c.val}</div>`;
            }
        });
    } catch(e) {
        console.error("–ë–∞–π–ª–∞–Ω—ã—Å –¥–µ—Ä–µ–≥—ñ–Ω –æ“õ—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã");
    }
    
    return html;
}

function filterMarkers() {
    const term = document.getElementById('searchInput').value.toLowerCase();
    markersGroup.clearLayers();
    let listHtml = '';

    rawData.forEach(i => {
        if(i.info.toLowerCase().includes(term) || i.title.toLowerCase().includes(term)) {
            const color = i.type==='worker'?'#007bff':(i.type==='good'?'#ffc107':'#28a745');
            
            // –ë–∞–π–ª–∞–Ω—ã—Å –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –¥–∞–π—ã–Ω–¥–∞—É (–¢–µ–∫ –º”ô—Ç—ñ–Ω –∂”ô–Ω–µ —Ç–∞“£–±–∞)
            let contactsHtml = '';
            if (i.phone) {
                contactsHtml += `<div class="contact-line"><span>üìû</span> <span>${i.phone}</span></div>`;
            }
            
            // “ö–æ—Å—ã–º—à–∞ –±–∞–π–ª–∞–Ω—ã—Å—Ç–∞—Ä (email, —Ç.–±.)
            try {
                const extra = typeof i.contacts === 'string' ? JSON.parse(i.contacts || '[]') : (i.contacts || []);
                extra.forEach(c => {
                    if (c.val && c.val !== i.phone) {
                        const icon = c.type === 'Email' ? 'üìß' : (c.type === 'WhatsApp' ? 'üí¨' : 'üîπ');
                        contactsHtml += `<div class="contact-line"><span>${icon}</span> <span>${c.val}</span></div>`;
                    }
                });
            } catch(e) {}

            // –ú–∞—Ä–∫–µ—Ä–¥—ñ “õ“±—Ä—É
            const m = L.marker([i.lat, i.lon], {
                icon: L.divIcon({ 
                    html: `
                        <div style="display:flex; flex-direction:column; align-items:center; position:relative;">
                            <div style="background:${color}; width:12px; height:12px; border-radius:50%; border:2px solid white; box-shadow:0 0 3px rgba(0,0,0,0.4);"></div>
                            <div class="marker-label" style="margin-top:2px;">${i.info.substring(0,10)}</div>
                        </div>`,
                    className: '', 
                    iconSize: [40, 40], 
                    iconAnchor: [20, 6] 
                })
            });

            // Popup (–ë–∞—Å“õ–∞–Ω–¥–∞ —à—ã“ì–∞—Ç—ã–Ω —Ç–µ—Ä–µ–∑–µ)
            m.bindPopup(`
                <div style="text-align:center; min-width:160px;">
                    <b style="color:${color}; font-size:16px;">${i.info}</b><br>
                    <span style="color:#555;">${i.title}</span><br>
                    <div style="margin:5px 0;">${contactsHtml}</div>
                    ${i.phone ? `<a href="tel:${i.phone}" style="display:block; background:green; color:white; padding:8px; border-radius:4px; text-decoration:none; font-weight:bold; margin-top:5px;">“ö–æ“£—ã—Ä–∞—É —à–∞–ª—É</a>` : ''}
                </div>
            `);
            markersGroup.addLayer(m);

            // –¢”©–º–µ–Ω–¥–µ–≥—ñ —Ç—ñ–∑—ñ–º
            listHtml += `
                <div class="list-item" style="padding:12px; border-bottom:1px solid #eee;">
                    <div style="flex-grow:1;">
                        <b style="color:${color}; font-size:15px;">${i.info}</b><br>
                        <small><b>${i.title}</b></small>
                        <div style="margin-top:5px;">${contactsHtml}</div>
                    </div>
                    <div>
                        ${i.phone ? `<a href="tel:${i.phone}" style="font-size:24px; text-decoration:none;"></a>` : ''}
                    </div>
                </div>`;
        }
    });
    document.getElementById('dynamic-list-content').innerHTML = listHtml;
}

    function saveItem(type, isVip) {
        let d = { is_vip: isVip, device_token: myToken };
        if(type==='worker') { d.name=v('w_name'); d.job=v('w_job'); d.contacts=collectContacts('w_contacts_list'); d.phone=JSON.parse(d.contacts)[0]?.val || ''; }
        if(type==='good') { d.name=v('g_name'); d.product=v('g_prod'); d.price=v('g_price'); d.contacts=collectContacts('g_contacts_list'); d.phone=JSON.parse(d.contacts)[0]?.val || ''; }
        if(type==='order') { d.name=v('c_name'); d.description=v('c_desc'); d.contacts=collectContacts('o_contacts_list'); d.phone=JSON.parse(d.contacts)[0]?.val || ''; }

        if(!d.name) return alert("–ê—Ç—ã“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑!");

        navigator.geolocation.getCurrentPosition(pos => {
            d.lat = pos.coords.latitude; d.lon = pos.coords.longitude;
            const endpoint = type==='worker'?'/save-worker':(type==='good'?'/save-goods':'/save-order');
            fetch(API + endpoint, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(d) })
            .then(r=>r.json()).then(res => {
                alert(isVip ? "VIP ”©—Ç—ñ–Ω—ñ–º –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ!" : "–°”ô—Ç—Ç—ñ –∂–∞—Ä–∏—è–ª–∞–Ω–¥—ã!");
                loadMarkers();
            });
        }, () => alert("GPS “õ–æ—Å—ã“£—ã–∑!"));
    }

    function renderAdmin() {
        document.getElementById('admin-modal').style.display = 'block';
        if(!adminDataFull) return;
        let h = `<table><tr><th>–£–∞“õ—ã—Ç—ã</th><th>–¢“Ø—Ä—ñ</th><th>–ê“õ–ø–∞—Ä–∞—Ç</th><th>–ë–∞–π–ª–∞–Ω—ã—Å—Ç–∞—Ä</th><th>”ò—Ä–µ–∫–µ—Ç</th></tr>`;
        ['workers', 'goods', 'orders'].forEach(cat => {
            adminDataFull[cat].forEach(item => {
                const date = new Date(item.created_at).toLocaleString('kk-KZ');
                h += `<tr>
                    <td>${date}</td>
                    <td>${cat}</td>
                    <td>${item.job || item.product_name || item.description}</td>
                    <td>${formatContacts(item.contacts)}</td>
                    <td>
                        <button onclick="toggleActive(${item.id},'${cat.slice(0,-1)}',${!item.is_active})" style="background:orange; font-size:9px;">VIP</button>
                        <button onclick="admDel(${item.id},'${cat.slice(0,-1)}')" style="background:red; font-size:9px;">–ñ–æ—é</button>
                    </td>
                </tr>`;
            });
        });
        document.getElementById('admin-content').innerHTML = h + "</table>";
    }

    // “ö–∞–ª“ì–∞–Ω —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä —Å—ñ–∑–¥—ñ“£ –∫–æ–¥—ã“£—ã–∑–±–µ–Ω –±—ñ—Ä–¥–µ–π
    function initVIP(type) { 
        const phone = "8 707 123 45 67"; 
        if(confirm(`üíé VIP –ñ–ê–†–ò–Ø–õ–ê–£ (490‚Ç∏)\n\n–¢”©–ª–µ–º –Ω”©–º—ñ—Ä—ñ (Kaspi/Halyk):\nüìç ${phone}\n\n–¢”©–ª–µ–ø –±–æ–ª—Å–∞“£—ã–∑ 'OK' –±–∞—Å—ã“£—ã–∑.`)) saveItem(type, true); 
    }

    function deleteItem(id, type) {
        if(confirm("”®—à—ñ—Ä–µ—Å—ñ–∑ –±–µ?")) fetch(API+'/delete-item',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,type,token:myToken})}).then(()=>loadMarkers());
    }

    function toggleActive(id, type, val) {
        fetch(API+'/admin/toggle-active',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,type,active:val})}).then(()=>loadMarkers());
    }

    function admDel(id, type) {
        if(confirm("–ê–¥–º–∏–Ω: ”®—à—ñ—Ä—É?")) fetch(API+'/delete-item',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,type,token:'admin777'})}).then(()=>loadMarkers());
    }

    window.onhashchange = () => {
        if(location.hash === '#admin777') {
            if(prompt("“ö“±–ø–∏—è —Å”©–∑:") === 'admin777') renderAdmin();
            else location.hash = '';
        } else document.getElementById('admin-modal').style.display = 'none';
    };

    function v(id){ return document.getElementById(id).value; }
    loadMarkers();
    setInterval(loadMarkers, 15000);
</script>
</body>
</html>
